{{ define "home" }}

{{ block "header" .}}{{ end }}
{{ block "navbar" .}}{{ end }}

<div class="container text-center main">
  <div class="col-12" style="margin-top: 35px;">
    <table class="table table-striped table-hover table-list-search">
      <thead class="thead-dark">
        <tr>
          <th>ID</th>
          <th>ФИО Клиента</th>
          <th>№ Счета СКС</th>
          <th>Организация</th>
          <th>Номер телефона</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {{range .data}}
        <tr class="item animate" data-ClientID="{{ .ClientID}}" data-DepositID="{{ .DepositID}}">
          <td>{{ .ID}}</td>
          <td>{{ .FullName}}</td>
          <td>{{ .Bill}}</td>
          <td>{{ .OrgName}}</td>
          <td>
            <div class="col-auto">
              <div class="input-group input-group-sm mb-2">
                <input type="text" name="phone" class="form-control PhoneNumber" value="{{ .Phone}}" disabled required>
                <div class="input-group-append">
                  <div class="input-group-text">&#9998;</div>
                </div>
              </div>
            </div>
            {{ .Phone}}
          </td>
          <td><button class="btn btn-success btn-sm">Утвердить</button></td>
        </tr>
        {{ end }}
      </tbody>
    </table>
  </div>

  {{ block "paggination" .}}{{ end }}

</div>

<style>
  .input-group-append {
    cursor: pointer !important;
  }
</style>

{{template "footer" .}}

<script>
  (function () {
    'use strict';
    let btn_deleted = document.querySelectorAll(".btn-success");
    var id = 1;

    document.querySelectorAll(".input-group-text").forEach((btn) => {
      btn.addEventListener('click', function (e) {
        let $el = e.target.closest('.input-group');
        $el.firstElementChild.disabled = !$el.firstElementChild.disabled
      })
    })

    btn_deleted.forEach((btn) => {
      btn.addEventListener('click', function (e) {
        let $el = e.target.closest('.item');
        let data = {
          "ClientID": $el.dataset.clientid,
          "DepositID": $el.dataset.depositid,
          "PhoneNumber": $el.querySelector(".PhoneNumber").value
        }
        fetch('/approve', {
          method: 'POST',
          body: JSON.stringify(data)
        }).then(async (r) => {
          let response = await r.json()
          // if (response.code == 200) $el.remove()
          console.log(response);
          createMessge(response.status)
          id++
        }).catch((err) => {
          console.error(err)
        })
      });
    });
  })();
</script>

{{ end }}